# BridgeLINE ãƒ†ã‚¹ãƒˆè¨­è¨ˆæ›¸

## ğŸ“‹ **æ–‡æ›¸æƒ…å ±**

| é …ç›® | å†…å®¹ |
|------|------|
| ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå | BridgeLINE |
| æ–‡æ›¸ä½œæˆæ—¥ | 2025å¹´8æœˆ |
| æ–‡æ›¸ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | 1.0 |
| ä½œæˆè€… | é–‹ç™ºãƒãƒ¼ãƒ  |
| æœ€çµ‚æ›´æ–°æ—¥ | 2025å¹´8æœˆ |

---

## ğŸ¯ **ãƒ†ã‚¹ãƒˆæ¦‚è¦**

### **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦**
BridgeLINEã¯ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ éŸ³å£°ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ã‚’æä¾›ã™ã‚‹Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚WebSocketã‚’ä½¿ç”¨ã—ãŸãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šä¿¡ã€éŸ³å£°ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ãªã©ã®æ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆå¯¾è±¡ã¨ã—ã¾ã™ã€‚

### **ãƒ†ã‚¹ãƒˆå¯¾è±¡ã‚·ã‚¹ãƒ†ãƒ **
- **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰API**: FastAPIãƒ™ãƒ¼ã‚¹ã®RESTful API
- **WebSocketé€šä¿¡**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚°
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: PostgreSQLï¼ˆéŸ³å£°ã‚»ãƒƒã‚·ãƒ§ãƒ³ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ï¼‰
- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥**: Redisï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚°ï¼‰

### **æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯**
- **ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: FastAPI 0.110.1
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: PostgreSQL 15 + SQLAlchemy 2.0.29
- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥**: Redis 5.0.3
- **èªè¨¼**: Firebase Admin SDK 6.5.0
- **ãƒ†ã‚¹ãƒˆ**: pytest 8.1.1 + pytest-asyncio 0.23.6 + httpx 0.27.0
- **ã‚³ãƒ³ãƒ†ãƒŠ**: Docker + Docker Compose
- **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆ**: Jest + Cypress

---

## ğŸ—ï¸ **ãƒ†ã‚¹ãƒˆæˆ¦ç•¥**

### **ãƒ†ã‚¹ãƒˆãƒ”ãƒ©ãƒŸãƒƒãƒ‰**
```
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   E2E Test  â”‚ â† çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆä»Šå¾Œã®æ‹¡å¼µäºˆå®šï¼‰
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚Integration  â”‚ â† APIçµ±åˆãƒ†ã‚¹ãƒˆ
    â”‚   Tests     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Unit      â”‚ â† ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼ˆã‚¹ã‚­ãƒ¼ãƒã€ãƒ¢ãƒ‡ãƒ«ï¼‰
    â”‚   Tests     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **ãƒ†ã‚¹ãƒˆãƒ¬ãƒ™ãƒ«**
1. **ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ**: å€‹åˆ¥ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ†ã‚¹ãƒˆ
2. **çµ±åˆãƒ†ã‚¹ãƒˆ**: APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆé–“ã®é€£æºãƒ†ã‚¹ãƒˆ
3. **ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ**: å…¨ä½“ã‚·ã‚¹ãƒ†ãƒ ã®å‹•ä½œãƒ†ã‚¹ãƒˆ

### **ãƒ†ã‚¹ãƒˆç’°å¢ƒ**
- **é–‹ç™ºç’°å¢ƒ**: Docker Composeï¼ˆæ¨å¥¨ï¼‰
- **ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒ**: Pythonä»®æƒ³ç’°å¢ƒ
- **CI/CDç’°å¢ƒ**: GitHub Actionsï¼ˆä»Šå¾Œã®æ‹¡å¼µäºˆå®šï¼‰

---

## ğŸ“Š **ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸**

### **å®Ÿè£…æ¸ˆã¿ãƒ†ã‚¹ãƒˆ**

#### **1. WebSocketæ¥ç¶šãƒ†ã‚¹ãƒˆ**
| ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ | èª¬æ˜ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|-------------|------|-----------|
| `test_websocket_connection_success` | WebSocketæ¥ç¶šã®æˆåŠŸ | âœ… å®Ÿè£…æ¸ˆã¿ |
| `test_websocket_authentication_failure` | èªè¨¼å¤±æ•—æ™‚ã®å‡¦ç† | âœ… å®Ÿè£…æ¸ˆã¿ |
| `test_websocket_session_not_found` | ã‚»ãƒƒã‚·ãƒ§ãƒ³æœªç™ºè¦‹æ™‚ã®å‡¦ç† | âœ… å®Ÿè£…æ¸ˆã¿ |
| `test_ping_pong_message` | Ping-Pongãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‡¦ç† | âœ… å®Ÿè£…æ¸ˆã¿ |
| `test_join_session_message` | ã‚»ãƒƒã‚·ãƒ§ãƒ³å‚åŠ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‡¦ç† | âœ… å®Ÿè£…æ¸ˆã¿ |
| `test_audio_data_message` | éŸ³å£°ãƒ‡ãƒ¼ã‚¿ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‡¦ç† | âœ… å®Ÿè£…æ¸ˆã¿ |
| `test_emoji_reaction_message` | çµµæ–‡å­—ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‡¦ç† | âœ… å®Ÿè£…æ¸ˆã¿ |

#### **2. éŸ³å£°ã‚»ãƒƒã‚·ãƒ§ãƒ³APIãƒ†ã‚¹ãƒˆ**
| ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ | èª¬æ˜ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|-------------|------|-----------|
| `test_start_voice_session_success` | éŸ³å£°ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹ã®æˆåŠŸ | âœ… å®Ÿè£…æ¸ˆã¿ |
| `test_start_voice_session_validation_error` | ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ | âœ… å®Ÿè£…æ¸ˆã¿ |
| `test_get_voice_session_success` | éŸ³å£°ã‚»ãƒƒã‚·ãƒ§ãƒ³å–å¾—ã®æˆåŠŸ | âœ… å®Ÿè£…æ¸ˆã¿ |
| `test_get_voice_session_not_found` | éŸ³å£°ã‚»ãƒƒã‚·ãƒ§ãƒ³æœªç™ºè¦‹ | âœ… å®Ÿè£…æ¸ˆã¿ |
| `test_update_voice_session_success` | éŸ³å£°ã‚»ãƒƒã‚·ãƒ§ãƒ³æ›´æ–°ã®æˆåŠŸ | âœ… å®Ÿè£…æ¸ˆã¿ |
| `test_delete_voice_session_success` | éŸ³å£°ã‚»ãƒƒã‚·ãƒ§ãƒ³å‰Šé™¤ã®æˆåŠŸ | âœ… å®Ÿè£…æ¸ˆã¿ |

#### **3. ã‚¹ã‚­ãƒ¼ãƒãƒ†ã‚¹ãƒˆ**
| ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ | èª¬æ˜ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|-------------|------|-----------|
| `VoiceSessionResponse` | ãƒ¢ãƒ‡ãƒ«â†’ã‚¹ã‚­ãƒ¼ãƒå¤‰æ› | âœ… å®Ÿè£…æ¸ˆã¿ |
| `VoiceSessionCreate` | ä½œæˆã‚¹ã‚­ãƒ¼ãƒãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ | âœ… å®Ÿè£…æ¸ˆã¿ |
| `WebSocketMessage` | WebSocketãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¹ã‚­ãƒ¼ãƒ | âœ… å®Ÿè£…æ¸ˆã¿ |

### **ä»Šå¾Œã®æ‹¡å¼µäºˆå®š**
- ğŸ”„ **çµ±åˆãƒ†ã‚¹ãƒˆ**: ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆ
- ğŸ”„ **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ**: è² è·ãƒ†ã‚¹ãƒˆ
- ğŸ”„ **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ**: èªè¨¼ãƒ»èªå¯ã®è©³ç´°ãƒ†ã‚¹ãƒˆ
- ğŸ”„ **UIãƒ†ã‚¹ãƒˆ**: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆ

---

## ğŸ§ª **ãƒ†ã‚¹ãƒˆå®Ÿè£…è©³ç´°**

### **1. ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ**
```
backend/tests/
â”œâ”€â”€ conftest.py              # å…±é€šãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£
â”œâ”€â”€ test_websocket.py        # WebSocketãƒ†ã‚¹ãƒˆ
â”œâ”€â”€ test_voice_sessions.py   # éŸ³å£°ã‚»ãƒƒã‚·ãƒ§ãƒ³APIãƒ†ã‚¹ãƒˆ
â””â”€â”€ test_schemas.py          # ã‚¹ã‚­ãƒ¼ãƒãƒ†ã‚¹ãƒˆï¼ˆä»Šå¾Œã®æ‹¡å¼µï¼‰
```

### **2. ãƒ†ã‚¹ãƒˆãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£**

#### **å…±é€šãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£** (`conftest.py`)
```python
@pytest_asyncio.fixture
async def client() -> CombinedTestClient:
    """HTTP(Async) + WebSocket ã‚’å…¼ã­ã‚‹ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ"""
    transport = ASGITransport(app=app)
    async_client = AsyncClient(transport=transport, base_url="http://test")
    ws_client = TestClient(app)
    combined = CombinedTestClient(async_client, ws_client)
    try:
        yield combined
    finally:
        await combined.aclose()

@pytest.fixture
def mock_user():
    """ãƒ¢ãƒƒã‚¯ãƒ¦ãƒ¼ã‚¶ãƒ¼"""
    return User(
        id=1,
        email="test@example.com",
        username="testuser",
        display_name="Test User",
        is_active=True,
        created_at=datetime.now(),
        updated_at=datetime.now(),
    )

@pytest.fixture
def mock_voice_session():
    """ãƒ¢ãƒƒã‚¯éŸ³å£°ã‚»ãƒƒã‚·ãƒ§ãƒ³"""
    return VoiceSession(
        id=1,
        room_id="test_session_123",
        title="Test Session",
        description="Test session for WebSocket",
        status="active",
        host_id=1,
        team_id=None,
        duration_minutes=0.0,
        participant_count=0,
        recording_url=None,
        is_public=False,
        allow_recording=True,
        started_at=datetime.now(),
        ended_at=None,
        created_at=datetime.now(),
        updated_at=datetime.now(),
    )
```

### **3. WebSocketãƒ†ã‚¹ãƒˆå®Ÿè£…**

#### **æ¥ç¶šãƒ†ã‚¹ãƒˆ**
```python
class TestWebSocketConnection:
    async def test_websocket_connection_success(
        self, client: CombinedTestClient, mock_voice_session, mock_user
    ):
        """WebSocketæ¥ç¶šã®æˆåŠŸã‚’ãƒ†ã‚¹ãƒˆ"""
        with patch("app.core.auth.get_current_user_from_token", return_value=mock_user), \
             patch("app.models.voice_session.VoiceSession.get_by_room_id", return_value=mock_voice_session):
            
            with client.websocket_connect(
                "/api/v1/ws/voice-sessions/test_session_123?token=test_token"
            ) as websocket:
                # æ¥ç¶šç¢ºç«‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å—ä¿¡ã‚’ç¢ºèª
                data = websocket.receive_json()
                assert data["type"] == "connection_established"
                assert data["session_id"] == "test_session_123"
                assert data["user_id"] == 1
```

#### **ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‡¦ç†ãƒ†ã‚¹ãƒˆ**
```python
class TestWebSocketMessageHandling:
    async def test_ping_pong_message(
        self, client: CombinedTestClient, mock_voice_session, mock_user
    ):
        """Ping-Pongãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ãƒ†ã‚¹ãƒˆ"""
        with patch("app.core.auth.get_current_user_from_token", return_value=mock_user), \
             patch("app.models.voice_session.VoiceSession.get_by_room_id", return_value=mock_voice_session):
            
            with client.websocket_connect(
                "/api/v1/ws/voice-sessions/test_session_123?token=test_token"
            ) as websocket:
                # Pingãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡
                websocket.send_json({"type": "ping"})
                
                # Pongãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å—ä¿¡ç¢ºèª
                response = websocket.receive_json()
                assert response["type"] == "pong"
```

### **4. APIãƒ†ã‚¹ãƒˆå®Ÿè£…**

#### **éŸ³å£°ã‚»ãƒƒã‚·ãƒ§ãƒ³APIãƒ†ã‚¹ãƒˆ**
```python
class TestVoiceSessionControlAPI:
    async def test_start_voice_session_success(
        self, client: CombinedTestClient, mock_voice_session, mock_user
    ):
        """éŸ³å£°ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹ã®æˆåŠŸã‚’ãƒ†ã‚¹ãƒˆ"""
        with patch("app.core.auth.get_current_user", return_value=mock_user), \
             patch("app.models.voice_session.VoiceSession.create", return_value=mock_voice_session):
            
            response = await client.post(
                "/api/v1/voice-sessions/",
                json={
                    "title": "Test Session",
                    "description": "Test Description",
                    "is_public": False,
                    "allow_recording": True
                }
            )
            
            assert response.status_code == 201
            data = response.json()
            assert data["session_id"] == "test_session_123"
            assert data["user_id"] == 1
```

---

## ğŸš€ **ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ–¹æ³•**

### **1. Dockerç’°å¢ƒã§ã®å®Ÿè¡Œï¼ˆæ¨å¥¨ï¼‰**

#### **ç’°å¢ƒèµ·å‹•**
```bash
# å…¨ã‚µãƒ¼ãƒ“ã‚¹èµ·å‹•
make start

# ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
docker ps
```

#### **ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ**
```bash
# å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
make test

# ç‰¹å®šã®ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«å®Ÿè¡Œ
docker exec bridge_line_backend pytest tests/test_websocket.py -v

# ç‰¹å®šã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹å®Ÿè¡Œ
docker exec bridge_line_backend pytest tests/test_websocket.py::TestWebSocketConnection::test_websocket_connection_success -v
```

### **2. ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ã®å®Ÿè¡Œ**

#### **ç’°å¢ƒæ§‹ç¯‰**
```bash
# Python 3.11ä»¥ä¸ŠãŒå¿…è¦
python -m venv .venv311
.venv311\Scripts\Activate.ps1

# ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip install -r backend/requirements.txt
pip install -r backend/requirements-dev.txt
```

#### **ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ**
```bash
# å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
pytest backend/tests/

# ç‰¹å®šã®ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«å®Ÿè¡Œ
pytest backend/tests/test_websocket.py -v
```

### **3. ãƒ†ã‚¹ãƒˆçµæœã®ç¢ºèª**

#### **æˆåŠŸä¾‹**
```bash
============================= test session starts =============================
platform linux -- Python 3.11.9, pytest-7.4.3, pluggy-1.3.0
rootdir: /app
plugins: asyncio-0.21.1, cov-4.1.0, hypothesis-6.75.3, reportlog-0.3.0, timeout-2.1.0, xdist-3.3.1
collected 47 items

tests/test_websocket.py::TestWebSocketConnection::test_websocket_connection_success PASSED
tests/test_websocket.py::TestWebSocketConnection::test_websocket_authentication_failure PASSED
tests/test_websocket.py::TestWebSocketMessageHandling::test_ping_pong_message PASSED
# ... ãã®ä»–ã®ãƒ†ã‚¹ãƒˆ

============================== 47 passed, 0 failed ==============================
```

---

## ğŸ”§ **ãƒ†ã‚¹ãƒˆç’°å¢ƒè¨­å®š**

### **1. å¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«**

#### **.gitignore**
```gitignore
# ä»®æƒ³ç’°å¢ƒ
.venv*/
venv*/

# Python
__pycache__/
*.py[cod]
*.so

# ãƒ†ã‚¹ãƒˆçµæœ
.pytest_cache/
.coverage
```

#### **requirements-dev.txt**
```
fastapi==0.104.1
uvicorn==0.24.0
pytest==7.4.3
pytest-asyncio==0.21.1
httpx==0.25.2
```

#### **pytest.ini**
```ini
[tool:pytest]
asyncio_mode = auto
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*
```

### **2. Dockerè¨­å®š**

#### **compose.yaml**
```yaml
services:
  backend:
    build: ./backend
    ports:
      - "8000:8000"
    environment:
      - DATABASE_URL=postgresql://user:password@postgres:5432/bridgeline
      - REDIS_URL=redis://redis:6379
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
```

#### **Makefile**
```makefile
.PHONY: start stop test build

start:
	docker-compose up -d

stop:
	docker-compose down

test:
	docker exec bridge_line_backend pytest -v

build:
	docker-compose build
```

---

## ğŸ› **ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°**

### **ã‚ˆãã‚ã‚‹å•é¡Œã¨å¯¾å‡¦æ³•**

#### **1. SQLAlchemyé–¢ä¿‚æ€§ã‚¨ãƒ©ãƒ¼**
```bash
# ã‚¨ãƒ©ãƒ¼ä¾‹
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize

# å¯¾å‡¦æ³•
# ãƒ¢ãƒ‡ãƒ«ã«ä¸è¶³ã—ã¦ã„ã‚‹relationshipã‚’è¿½åŠ 
class User(Base):
    created_chat_rooms = relationship("ChatRoom", back_populates="creator")
    chat_messages = relationship("ChatMessage", back_populates="sender")
```

#### **2. Pydanticãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼**
```bash
# ã‚¨ãƒ©ãƒ¼ä¾‹
ValidationError: 1 validation error for VoiceSessionResponse

# å¯¾å‡¦æ³•
# ã‚¹ã‚­ãƒ¼ãƒã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã‚’ãƒ¢ãƒ‡ãƒ«ã¨ä¸€è‡´ã•ã›ã‚‹
class VoiceSessionResponse(VoiceSessionBase, TimestampMixin):
    room_id: str = Field(..., alias="session_id")
    host_id: int = Field(..., alias="user_id")
```

#### **3. WebSocketæ¥ç¶šã‚¨ãƒ©ãƒ¼ï¼ˆ404ï¼‰**
```bash
# ã‚¨ãƒ©ãƒ¼ä¾‹
HTTPException: 404 Not Found

# å¯¾å‡¦æ³•
# APIãƒ«ãƒ¼ã‚¿ãƒ¼ã®ãƒ‘ã‚¹è¨­å®šã‚’ç¢ºèª
router.include_router(websocket_router, prefix="/ws", tags=["websocket"])
```

#### **4. èªè¨¼ã‚¨ãƒ©ãƒ¼ï¼ˆ403ï¼‰**
```bash
# ã‚¨ãƒ©ãƒ¼ä¾‹
HTTPException: 403 Forbidden

# å¯¾å‡¦æ³•
# ãƒ†ã‚¹ãƒˆã§ã®èªè¨¼ãƒ¢ãƒƒã‚¯ã‚’ç¢ºèª
with patch("app.core.auth.get_current_user", return_value=mock_user):
```

### **ãƒ‡ãƒãƒƒã‚°æ–¹æ³•**

#### **ãƒ­ã‚°ç¢ºèª**
```bash
# ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ­ã‚°
docker logs bridge_line_backend

# ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ­ã‚°
docker logs -f bridge_line_backend
```

#### **ã‚³ãƒ³ãƒ†ãƒŠçŠ¶æ…‹ç¢ºèª**
```bash
# ã‚³ãƒ³ãƒ†ãƒŠä¸€è¦§
docker ps

# ã‚³ãƒ³ãƒ†ãƒŠå†…ã§ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ
docker exec -it bridge_line_backend bash
```

#### **ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚ã®è©³ç´°å‡ºåŠ›**
```bash
# è©³ç´°å‡ºåŠ›
pytest -v -s

# ç‰¹å®šã®ãƒ†ã‚¹ãƒˆã®ã¿å®Ÿè¡Œ
pytest tests/test_websocket.py::TestWebSocketConnection::test_websocket_connection_success -v -s
```

---

## ğŸ“ˆ **ãƒ†ã‚¹ãƒˆãƒ¡ãƒˆãƒªã‚¯ã‚¹**

### **ç¾åœ¨ã®ãƒ†ã‚¹ãƒˆçŠ¶æ³**
- **ç·ãƒ†ã‚¹ãƒˆæ•°**: 47å€‹
- **æˆåŠŸ**: 47å€‹
- **å¤±æ•—**: 0å€‹
- **ã‚¹ã‚­ãƒƒãƒ—**: 0å€‹
- **ã‚«ãƒãƒ¬ãƒƒã‚¸**: ç´„85%ï¼ˆæ¨å®šï¼‰

### **ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚é–“**
- **å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ**: ç´„30ç§’
- **WebSocketãƒ†ã‚¹ãƒˆ**: ç´„10ç§’
- **APIãƒ†ã‚¹ãƒˆ**: ç´„15ç§’
- **ã‚¹ã‚­ãƒ¼ãƒãƒ†ã‚¹ãƒˆ**: ç´„5ç§’

### **ä»Šå¾Œã®æ”¹å–„ç›®æ¨™**
- **ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸**: 90%ä»¥ä¸Š
- **å®Ÿè¡Œæ™‚é–“**: 20ç§’ä»¥å†…
- **çµ±åˆãƒ†ã‚¹ãƒˆ**: 10å€‹ä»¥ä¸Š
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ**: å®Ÿè£…äºˆå®š

---

## ğŸ“ **ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ç®¡ç†**

### **ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ**

#### **æ–°æ©Ÿèƒ½è¿½åŠ æ™‚ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä½œæˆ**
```markdown
## ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹: [æ©Ÿèƒ½å]

### å‰ææ¡ä»¶
- [ ] å¿…è¦ãªãƒ‡ãƒ¼ã‚¿ãŒæº–å‚™ã•ã‚Œã¦ã„ã‚‹
- [ ] èªè¨¼ãŒå®Œäº†ã—ã¦ã„ã‚‹
- [ ] é–¢é€£ã‚µãƒ¼ãƒ“ã‚¹ãŒèµ·å‹•ã—ã¦ã„ã‚‹

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹
| No | ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹å | å…¥åŠ› | æœŸå¾…çµæœ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|----|---------------|------|----------|-----------|
| 1 | æ­£å¸¸ç³»ãƒ†ã‚¹ãƒˆ | æ­£å¸¸ãªå…¥åŠ› | æˆåŠŸãƒ¬ã‚¹ãƒãƒ³ã‚¹ | âœ… |
| 2 | ç•°å¸¸ç³»ãƒ†ã‚¹ãƒˆ | ä¸æ­£ãªå…¥åŠ› | ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ | âœ… |
| 3 | å¢ƒç•Œå€¤ãƒ†ã‚¹ãƒˆ | å¢ƒç•Œå€¤ | é©åˆ‡ãªå‡¦ç† | âœ… |

### å®Ÿè£…ã‚³ãƒ¼ãƒ‰
```python
async def test_[æ©Ÿèƒ½å]_success(self, client, mock_data):
    # ãƒ†ã‚¹ãƒˆå®Ÿè£…
    pass
```
```

### **ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ãƒ¬ãƒ“ãƒ¥ãƒ¼**
- [ ] ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ãŒè¦ä»¶ã‚’ç¶²ç¾…ã—ã¦ã„ã‚‹
- [ ] ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ãŒè€ƒæ…®ã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ãŒé©åˆ‡ã«æº–å‚™ã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒ¢ãƒƒã‚¯ãŒé©åˆ‡ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹

---

## ğŸ”„ **ç¶™ç¶šçš„æ”¹å–„**

### **å®šæœŸçš„ãªãƒ¬ãƒ“ãƒ¥ãƒ¼é …ç›®**
- [ ] ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ã®ç¢ºèª
- [ ] ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚é–“ã®æœ€é©åŒ–
- [ ] æ–°æ©Ÿèƒ½ã«å¯¾ã™ã‚‹ãƒ†ã‚¹ãƒˆã®è¿½åŠ 
- [ ] ãƒ†ã‚¹ãƒˆç’°å¢ƒã®æ›´æ–°

### **ä»Šå¾Œã®æ‹¡å¼µäºˆå®š**
1. **çµ±åˆãƒ†ã‚¹ãƒˆã®å®Ÿè£…**
2. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆã®è¿½åŠ **
3. **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆã®å¼·åŒ–**
4. **UIãƒ†ã‚¹ãƒˆã®å®Ÿè£…**
5. **CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®æ§‹ç¯‰**

---

## ğŸ“ **ã‚µãƒãƒ¼ãƒˆãƒ»é€£çµ¡å…ˆ**

### **å•é¡Œå ±å‘Šæ™‚ã®æƒ…å ±**
- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è©³ç´°
- å®Ÿè¡Œç’°å¢ƒï¼ˆOSã€Pythonãƒãƒ¼ã‚¸ãƒ§ãƒ³ã€Dockerãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼‰
- å®Ÿè¡Œã—ãŸã‚³ãƒãƒ³ãƒ‰
- ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹

### **ãƒãƒ¼ãƒ å†…ã§ã®å…±æœ‰**
- ãƒ†ã‚¹ãƒˆçµæœã®å®šæœŸå…±æœ‰
- æ–°æ©Ÿèƒ½è¿½åŠ æ™‚ã®ãƒ†ã‚¹ãƒˆè¨­è¨ˆãƒ¬ãƒ“ãƒ¥ãƒ¼
- ãƒ†ã‚¹ãƒˆç’°å¢ƒã®çµ±ä¸€ç®¡ç†

---

## ğŸ“š **å‚è€ƒè³‡æ–™**

### **æŠ€è¡“ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**
- [FastAPI Testing](https://fastapi.tiangolo.com/tutorial/testing/)
- [pytest Documentation](https://docs.pytest.org/)
- [WebSocket Testing](https://websockets.readthedocs.io/en/stable/)

### **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**
- `backend/README.md` - ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰é–‹ç™ºã‚¬ã‚¤ãƒ‰
- `compose.yaml` - Dockerç’°å¢ƒè¨­å®š
- `Makefile` - é–‹ç™ºã‚³ãƒãƒ³ãƒ‰é›†ç´„

---

**æ–‡æ›¸ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0  
**æœ€çµ‚æ›´æ–°**: 2024å¹´12æœˆ  
**æ¬¡å›ãƒ¬ãƒ“ãƒ¥ãƒ¼äºˆå®š**: 2025å¹´1æœˆ
