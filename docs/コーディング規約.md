# Bridge LINE - ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„

## æ¦‚è¦

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€Bridge LINEãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ãŠã‘ã‚‹ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„ã‚’å®šç¾©ã—ã¾ã™ã€‚ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆNext.js + TypeScriptï¼‰ã¨ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆFastAPI + Pythonï¼‰ã®ä¸¡æ–¹ã«å¯¾å¿œã—ãŸçµ±ä¸€çš„ãªè¦ç´„ã‚’å®šã‚ã¦ã„ã¾ã™ã€‚

> ğŸ“š **é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: [é–‹ç™ºãƒ«ãƒ¼ãƒ«.md](é–‹ç™ºãƒ«ãƒ¼ãƒ«.md) ã‚’å‚ç…§

---

## 1. å‘½åè¦å‰‡

### 1-1. å¤‰æ•°ãƒ»é–¢æ•°ãƒ»ã‚¯ãƒ©ã‚¹å

#### **camelCase**: å¤‰æ•°ã€é–¢æ•°ã€ãƒ¡ã‚½ãƒƒãƒ‰å
```typescript
// ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
const userName = "ç”°ä¸­å¤ªéƒ";
const getUserProfile = () => {};
const isUserActive = true;

// ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
user_name = "ç”°ä¸­å¤ªéƒ"
def get_user_profile(): pass
is_user_active = True
```

#### **PascalCase**: ã‚¯ãƒ©ã‚¹ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã€å‹å®šç¾©
```typescript
// ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
class UserProfile {}
interface UserData {}
const UserProfileComponent = () => {};
type UserStatus = "active" | "inactive";

// ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
class UserProfile: pass
class UserData: pass
```

#### **SCREAMING_SNAKE_CASE**: å®šæ•°
```typescript
// ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
const API_BASE_URL = "https://api.bridge-line.com";
const MAX_RETRY_COUNT = 3;
const DEFAULT_TIMEOUT = 5000;

// ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
API_BASE_URL = "https://api.bridge-line.com"
MAX_RETRY_COUNT = 3
DEFAULT_TIMEOUT = 5000
```

### 1-2. ãƒ•ã‚¡ã‚¤ãƒ«ãƒ»ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå

#### **kebab-case**: ãƒ•ã‚¡ã‚¤ãƒ«åã€ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå
```
user-profile.tsx
voice-chat-session.ts
user-profile.component.tsx
api/
components/
voice-chat/
```

### 1-3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é–¢é€£

#### **snake_case**: ãƒ†ãƒ¼ãƒ–ãƒ«åã€ã‚«ãƒ©ãƒ å
```sql
user_profiles
voice_chat_sessions
created_at
updated_at
team_id
user_id
```

---

## 2. ã‚³ãƒ¡ãƒ³ãƒˆè¨˜è¿°ãƒ«ãƒ¼ãƒ«

### 2-1. é–¢æ•°ãƒ»ãƒ¡ã‚½ãƒƒãƒ‰ã®ã‚³ãƒ¡ãƒ³ãƒˆ

#### **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆJSDocå½¢å¼ï¼‰**
```typescript
/**
 * ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’å–å¾—ã™ã‚‹
 * @param userId - ãƒ¦ãƒ¼ã‚¶ãƒ¼ID
 * @param includeTeam - ãƒãƒ¼ãƒ æƒ…å ±ã‚’å«ã‚ã‚‹ã‹ã©ã†ã‹
 * @returns Promise<UserProfile> - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æƒ…å ±
 * @throws {Error} - APIé€šä¿¡ã‚¨ãƒ©ãƒ¼æ™‚
 * @example
 * ```typescript
 * const profile = await getUserProfile("user123", true);
 * console.log(profile.name);
 * ```
 */
const getUserProfile = async (
  userId: string, 
  includeTeam: boolean = false
): Promise<UserProfile> => {
  // å®Ÿè£…
};
```

#### **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆPython docstringå½¢å¼ï¼‰**
```python
def get_user_profile(user_id: str, include_team: bool = False) -> UserProfile:
    """
    ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’å–å¾—ã™ã‚‹
    
    Args:
        user_id (str): ãƒ¦ãƒ¼ã‚¶ãƒ¼ID
        include_team (bool, optional): ãƒãƒ¼ãƒ æƒ…å ±ã‚’å«ã‚ã‚‹ã‹ã©ã†ã‹. Defaults to False.
        
    Returns:
        UserProfile: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æƒ…å ±
        
    Raises:
        HTTPException: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆ
        ValidationError: å…¥åŠ›å€¤ãŒä¸æ­£ãªå ´åˆ
        
    Example:
        >>> profile = get_user_profile("user123", True)
        >>> print(profile.name)
    """
    pass
```

### 2-2. è¤‡é›‘ãªãƒ­ã‚¸ãƒƒã‚¯ã®ã‚³ãƒ¡ãƒ³ãƒˆ

```typescript
// éŸ³å£°ãƒ‡ãƒ¼ã‚¿ã®å‰å‡¦ç†
// 1. ãƒã‚¤ã‚ºé™¤å»ï¼ˆãƒãƒ³ãƒ‰ãƒ‘ã‚¹ãƒ•ã‚£ãƒ«ã‚¿é©ç”¨ï¼‰
// 2. éŸ³é‡æ­£è¦åŒ–ï¼ˆRMSå€¤ã§0.8ã«èª¿æ•´ï¼‰
// 3. ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå¤‰æ›ï¼ˆ44.1kHz, 16bit, ãƒ¢ãƒãƒ©ãƒ«ï¼‰
const preprocessAudio = (audioData: AudioBuffer) => {
  // å®Ÿè£…
};

// è¤‡é›‘ãªæ¡ä»¶åˆ†å²ã®èª¬æ˜
if (user.role === 'admin' && user.teamId === currentTeamId) {
  // ç®¡ç†è€…ã‹ã¤ç¾åœ¨ã®ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ã®å ´åˆã®ã¿å®Ÿè¡Œ
  // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã€æ¨©é™ãƒã‚§ãƒƒã‚¯ã‚’å³å¯†ã«è¡Œã†
}
```

### 2-3. TODOãƒ»FIXMEã‚³ãƒ¡ãƒ³ãƒˆ

```typescript
// TODO: 2024å¹´3æœˆã¾ã§ã«WebSocketæ¥ç¶šã®å®‰å®šæ€§ã‚’å‘ä¸Šã•ã›ã‚‹
// FIXME: ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ã®å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®å‰Šé™¤ã‚’ç¢ºèª
// NOTE: ã“ã®å‡¦ç†ã¯ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã«å½±éŸ¿ã™ã‚‹ãŸã‚ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æ¤œè¨
```

---

## 3. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### 3-1. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰

#### **APIå‘¼ã³å‡ºã—æ™‚ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**
```typescript
// APIå‘¼ã³å‡ºã—æ™‚ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
const fetchUserData = async (userId: string) => {
  try {
    const response = await api.get(`/users/${userId}`);
    return response.data;
  } catch (error) {
    if (error.response?.status === 404) {
      throw new Error('ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
    } else if (error.response?.status === 403) {
      throw new Error('ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“');
    } else if (error.response?.status >= 500) {
      throw new Error('ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã—ã°ã‚‰ãæ™‚é–“ã‚’ãŠã„ã¦å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚');
    } else {
      throw new Error('ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');
    }
  }
};
```

#### **ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã®ã‚¨ãƒ©ãƒ¼è¡¨ç¤º**
```typescript
const UserProfile = () => {
  const [error, setError] = useState<string | null>(null);
  const [loading, setLoading] = useState(false);
  
  const handleError = (error: Error) => {
    setError(error.message);
    toast.error(error.message);
    // ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã®é€ä¿¡
    logger.error('UserProfile error', { error: error.message });
  };
  
  const handleRetry = () => {
    setError(null);
    // å†è©¦è¡Œãƒ­ã‚¸ãƒƒã‚¯
  };
  
  return (
    <div>
      {error && (
        <div className="error-message">
          <p>{error}</p>
          <button onClick={handleRetry}>å†è©¦è¡Œ</button>
        </div>
      )}
      {/* ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…å®¹ */}
    </div>
  );
};
```

### 3-2. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰

#### **ã‚«ã‚¹ã‚¿ãƒ ä¾‹å¤–ã®å®šç¾©**
```python
# ã‚«ã‚¹ã‚¿ãƒ ä¾‹å¤–ã®å®šç¾©
class UserNotFoundError(Exception):
    """ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã®ä¾‹å¤–"""
    pass

class InsufficientPermissionError(Exception):
    """æ¨©é™ä¸è¶³ã®å ´åˆã®ä¾‹å¤–"""
    pass

class ValidationError(Exception):
    """å…¥åŠ›å€¤æ¤œè¨¼ã‚¨ãƒ©ãƒ¼ã®ä¾‹å¤–"""
    pass
```

#### **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**
```python
async def get_user_profile(user_id: str) -> UserProfile:
    try:
        # å…¥åŠ›å€¤æ¤œè¨¼
        if not user_id or not isinstance(user_id, str):
            raise ValidationError("Invalid user ID")
            
        user = await user_repository.get_by_id(user_id)
        if not user:
            raise UserNotFoundError(f"User {user_id} not found")
            
        return user
        
    except UserNotFoundError:
        logger.warning(f"User not found: {user_id}")
        raise HTTPException(status_code=404, detail="ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“")
    except ValidationError as e:
        logger.warning(f"Validation error: {e}")
        raise HTTPException(status_code=400, detail=str(e))
    except Exception as e:
        logger.error(f"Unexpected error in get_user_profile: {e}")
        raise HTTPException(status_code=500, detail="å†…éƒ¨ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼")
```

---

## 4. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„

### 4-1. å…¥åŠ›å€¤æ¤œè¨¼

#### **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ - Zodã‚’ä½¿ç”¨ã—ãŸãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³**
```typescript
import { z } from 'zod';

const userSchema = z.object({
  name: z.string()
    .min(1, 'åå‰ã¯å¿…é ˆã§ã™')
    .max(100, 'åå‰ã¯100æ–‡å­—ä»¥å†…ã§å…¥åŠ›ã—ã¦ãã ã•ã„')
    .regex(/^[a-zA-Z0-9\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF\s]+$/, 'åå‰ã¯è‹±æ•°å­—ã€ã²ã‚‰ãŒãªã€ã‚«ã‚¿ã‚«ãƒŠã€æ¼¢å­—ã®ã¿ä½¿ç”¨å¯èƒ½ã§ã™'),
  email: z.string()
    .email('æœ‰åŠ¹ãªãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„')
    .max(255, 'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯255æ–‡å­—ä»¥å†…ã§å…¥åŠ›ã—ã¦ãã ã•ã„'),
  age: z.number()
    .min(0, 'å¹´é½¢ã¯0ä»¥ä¸Šã§å…¥åŠ›ã—ã¦ãã ã•ã„')
    .max(150, 'å¹´é½¢ã¯150ä»¥ä¸‹ã§å…¥åŠ›ã—ã¦ãã ã•ã„'),
});

const validateUserInput = (data: unknown) => {
  try {
    return userSchema.parse(data);
  } catch (error) {
    if (error instanceof z.ZodError) {
      const messages = error.errors.map(e => e.message);
      throw new Error(`å…¥åŠ›å€¤ãŒä¸æ­£ã§ã™: ${messages.join(', ')}`);
    }
    throw new Error('å…¥åŠ›å€¤ãŒä¸æ­£ã§ã™');
  }
};
```

#### **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ - Pydanticã‚’ä½¿ç”¨ã—ãŸãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³**
```python
from pydantic import BaseModel, validator, EmailStr
import re

class UserCreateRequest(BaseModel):
    name: str
    email: EmailStr
    age: int
    
    @validator('name')
    def validate_name(cls, v):
        if not v or len(v) > 100:
            raise ValueError('åå‰ã¯1-100æ–‡å­—ã§å…¥åŠ›ã—ã¦ãã ã•ã„')
        if not re.match(r'^[a-zA-Z0-9\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF\s]+$', v):
            raise ValueError('åå‰ã¯è‹±æ•°å­—ã€ã²ã‚‰ãŒãªã€ã‚«ã‚¿ã‚«ãƒŠã€æ¼¢å­—ã®ã¿ä½¿ç”¨å¯èƒ½ã§ã™')
        return v.strip()
    
    @validator('age')
    def validate_age(cls, v):
        if v < 0 or v > 150:
            raise ValueError('å¹´é½¢ã¯0-150ã®ç¯„å›²ã§å…¥åŠ›ã—ã¦ãã ã•ã„')
        return v
```

### 4-2. SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯¾ç­–

```python
# ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–ã‚¯ã‚¨ãƒªã®ä½¿ç”¨
async def get_user_by_email(email: str) -> Optional[User]:
    query = text("SELECT * FROM users WHERE email = :email")
    result = await database.fetch_one(query, {"email": email})
    return result

# å‹•çš„ã‚¯ã‚¨ãƒªã®å®‰å…¨ãªæ§‹ç¯‰
async def search_users(search_term: str, limit: int = 10) -> List[User]:
    # æ¤œç´¢èªã®ã‚µãƒ‹ã‚¿ã‚¤ã‚º
    safe_search_term = re.sub(r'[^\w\s\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]', '', search_term)
    
    query = text("""
        SELECT * FROM users 
        WHERE name ILIKE :search_term 
        ORDER BY created_at DESC 
        LIMIT :limit
    """)
    result = await database.fetch_all(query, {
        "search_term": f"%{safe_search_term}%",
        "limit": limit
    })
    return result
```

### 4-3. XSSå¯¾ç­–

```typescript
// ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ - å±é™ºãªHTMLã®ã‚µãƒ‹ã‚¿ã‚¤ã‚º
import DOMPurify from 'dompurify';

const sanitizeHtml = (html: string) => {
  return DOMPurify.sanitize(html, {
    ALLOWED_TAGS: ['b', 'i', 'em', 'strong', 'p', 'br'],
    ALLOWED_ATTR: []
  });
};

// React - dangerouslySetInnerHTMLã®ä½¿ç”¨ã‚’é¿ã‘ã‚‹
const UserMessage = ({ message }: { message: string }) => {
  // è‡ªå‹•çš„ã«ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã•ã‚Œã‚‹
  return <div>{message}</div>;
};

// ã‚„ã‚€ã‚’å¾—ãšHTMLã‚’è¡¨ç¤ºã™ã‚‹å ´åˆ
const UserMessageWithHtml = ({ message }: { message: string }) => {
  const sanitizedMessage = sanitizeHtml(message);
  return <div dangerouslySetInnerHTML={{ __html: sanitizedMessage }} />;
};
```

### 4-4. CSRFå¯¾ç­–

```typescript
// ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ - CSRFãƒˆãƒ¼ã‚¯ãƒ³ã®é€ä¿¡
const api = axios.create({
  baseURL: process.env.NEXT_PUBLIC_API_URL,
  headers: {
    'X-CSRF-Token': getCsrfToken(),
  },
});
```

---

## 5. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### 5-1. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰

#### **React.memoã®ä½¿ç”¨**
```typescript
// ä¸è¦ãªå†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’é˜²ã
const UserProfile = React.memo(({ user }: { user: User }) => {
  return (
    <div>
      <h3>{user.name}</h3>
      <p>{user.email}</p>
    </div>
  );
});

// ã‚«ã‚¹ã‚¿ãƒ æ¯”è¼ƒé–¢æ•°ã‚’ä½¿ç”¨
const UserList = React.memo(({ users }: { users: User[] }) => {
  return (
    <ul>
      {users.map(user => (
        <UserProfile key={user.id} user={user} />
      ))}
    </ul>
  );
}, (prevProps, nextProps) => {
  return prevProps.users.length === nextProps.users.length &&
         prevProps.users.every((user, index) => 
           user.id === nextProps.users[index]?.id
         );
});
```

#### **useMemoã®ä½¿ç”¨**
```typescript
const UserDashboard = ({ users, filters }: { users: User[], filters: FilterState }) => {
  // é‡ã„è¨ˆç®—ã‚’ãƒ¡ãƒ¢åŒ–
  const filteredUsers = useMemo(() => {
    return users.filter(user => {
      if (filters.role && user.role !== filters.role) return false;
      if (filters.teamId && user.teamId !== filters.teamId) return false;
      return true;
    });
  }, [users, filters]);

  // ã‚½ãƒ¼ãƒˆå‡¦ç†ã‚‚ãƒ¡ãƒ¢åŒ–
  const sortedUsers = useMemo(() => {
    return [...filteredUsers].sort((a, b) => 
      a.name.localeCompare(b.name, 'ja')
    );
  }, [filteredUsers]);

  return (
    <div>
      {sortedUsers.map(user => (
        <UserCard key={user.id} user={user} />
      ))}
    </div>
  );
};
```

#### **useCallbackã®ä½¿ç”¨**
```typescript
const UserList = ({ users, onUserSelect }: { users: User[], onUserSelect: (user: User) => void }) => {
  // ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã‚’ãƒ¡ãƒ¢åŒ–
  const handleUserClick = useCallback((user: User) => {
    onUserSelect(user);
  }, [onUserSelect]);

  return (
    <div>
      {users.map(user => (
        <UserCard 
          key={user.id} 
          user={user} 
          onClick={() => handleUserClick(user)}
        />
      ))}
    </div>
  );
};
```

### 5-2. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰

#### **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ã‚¨ãƒªã®æœ€é©åŒ–**
```python
# N+1å•é¡Œã‚’é¿ã‘ã‚‹ãŸã‚ã€JOINã‚’ä½¿ç”¨
async def get_users_with_teams():
    query = """
    SELECT 
        u.id, u.name, u.email, u.created_at,
        t.id as team_id, t.name as team_name
    FROM users u 
    LEFT JOIN teams t ON u.team_id = t.id
    ORDER BY u.created_at DESC
    """
    return await database.fetch_all(query)

# ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè£…
async def get_users_paginated(page: int = 1, page_size: int = 20):
    offset = (page - 1) * page_size
    query = """
    SELECT * FROM users 
    ORDER BY created_at DESC 
    LIMIT :limit OFFSET :offset
    """
    return await database.fetch_all(query, {
        "limit": page_size,
        "offset": offset
    })
```

#### **ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ä½¿ç”¨**
```python
from functools import lru_cache
import redis
from typing import Optional

# ãƒ¡ãƒ¢ãƒªã‚­ãƒ£ãƒƒã‚·ãƒ¥
@lru_cache(maxsize=128)
def get_user_permissions(user_id: str):
    """æ¨©é™æƒ…å ±ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼ˆãƒ¡ãƒ¢ãƒªï¼‰"""
    # æ¨©é™æƒ…å ±ã®å–å¾—ãƒ­ã‚¸ãƒƒã‚¯
    pass

# Redisã‚­ãƒ£ãƒƒã‚·ãƒ¥
async def get_user_profile_cached(user_id: str) -> Optional[UserProfile]:
    """ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼ˆRedisï¼‰"""
    cache_key = f"user_profile:{user_id}"
    
    # ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰å–å¾—ã‚’è©¦è¡Œ
    cached_data = await redis_client.get(cache_key)
    if cached_data:
        return UserProfile.parse_raw(cached_data)
    
    # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰å–å¾—
    user_profile = await get_user_profile(user_id)
    if user_profile:
        # ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä¿å­˜ï¼ˆ5åˆ†é–“ï¼‰
        await redis_client.setex(
            cache_key, 
            300, 
            user_profile.json()
        )
    
    return user_profile
```

---

## 6. ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯

### 6-1. å®Ÿè£…å‰ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] å‹å®šç¾©ã®ç¢ºèª
- [ ] APIä»•æ§˜ã®ç¢ºèª
- [ ] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆã®ç¢ºèª
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶ã®ç¢ºèª
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¦ä»¶ã®ç¢ºèª

### 6-2. å®Ÿè£…ä¸­ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] å‹ã‚¨ãƒ©ãƒ¼ã®è§£æ¶ˆ
- [ ] Lintingã‚¨ãƒ©ãƒ¼ã®è§£æ¶ˆ
- [ ] ãƒ†ã‚¹ãƒˆã®ä½œæˆãƒ»å®Ÿè¡Œ
- [ ] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æ›´æ–°
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®å®Ÿè£…

### 6-3. å®Ÿè£…å¾Œãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] å…¨ãƒ†ã‚¹ãƒˆã®é€šé
- [ ] å‹ãƒã‚§ãƒƒã‚¯ã®é€šé
- [ ] ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®å®Œäº†
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ã®å®Œäº†
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆã®å®Œäº†

---

## 7. ãƒ„ãƒ¼ãƒ«è¨­å®š

### 7-1. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰

#### **ESLintè¨­å®š**
```json
{
  "extends": [
    "next/core-web-vitals",
    "@typescript-eslint/recommended"
  ],
  "rules": {
    "@typescript-eslint/no-unused-vars": "error",
    "@typescript-eslint/explicit-function-return-type": "warn",
    "prefer-const": "error"
  }
}
```

#### **Prettierè¨­å®š**
```javascript
module.exports = {
  printWidth: 80,
  tabWidth: 2,
  useTabs: false,
  semi: true,
  singleQuote: true,
  trailingComma: 'es5',
  endOfLine: 'lf',
};
```

### 7-2. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰

#### **Blackè¨­å®š**
```toml
[tool.black]
line-length = 88
target-version = ['py39', 'py310', 'py311', 'py312']
```

#### **isortè¨­å®š**
```toml
[tool.isort]
profile = "black"
line_length = 88
multi_line_output = 3
```

#### **MyPyè¨­å®š**
```toml
[tool.mypy]
python_version = "3.9"
strict = true
warn_return_any = true
warn_unused_configs = true
```

---

## 8. å‚è€ƒè³‡æ–™

- [TypeScriptå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://www.typescriptlang.org/docs/)
- [Reactå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://react.dev/)
- [FastAPIå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://fastapi.tiangolo.com/)
- [Pythonå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.python.org/3/)
- [OWASPã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³](https://owasp.org/)
